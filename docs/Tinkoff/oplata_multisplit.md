# Оплата в системе Мультирасчётов (EACQ). Ключевые факты

Источник: «Протокол EACQ. Мультирасчёты», версия 1.8 от 13.11.2025 :contentReference[oaicite:0]{index=0}

---

## 1. Назначение раздела

Раздел описывает **механизмы приёма платежей** в системе Мультирасчётов Т-Банка:
- стандартные карточные платежи;
- T-Pay Web;
- QR-платежи;
- форматы ответов, статусы транзакций и расчёт возмещений.

---

## 2. Общая структура платежей

### 2.1. Объект `Payments` (в ответах)

Каждый элемент массива `Payments` содержит:

**Обязательные поля**
- `PaymentId` — уникальный идентификатор транзакции в системе банка
- `Status` — статус транзакции
- `Success` — успешность операции (`true` / `false`)
- `ErrorCode` — код ошибки (`"0"` при успехе)
- `Message` — описание результата или ошибки

**Необязательные поля**
- `Amount` — сумма операции в копейках
- `RRN` — RRN операции

---

## 3. Статусы транзакций (факт)

Примеры зафиксированных статусов:
- `NEW`
- `REJECTED`
- `AUTH_FAIL`

Статус влияет на:
- участие операции в реестре;
- расчёт комиссии;
- возмещение.

---

## 4. Оплата через T-Pay Web

### 4.1. Общая схема

Оплата выполняется **последовательным вызовом методов**:
1. `/TinkoffPay/terminals/{terminalKey}/status`
2. `/init`
3. Один из методов:
   - `/TinkoffPay/transactions/{paymentId}/versions/{version}/link`
   - `/TinkoffPay/{paymentId}/QR`

Оплата доступна:
- на мобильных устройствах;
- на десктопах.

---

### 4.2. Метод проверки доступности T-Pay

**Метод:** `GET`  
**URL:**
- Тест: `https://rest-api-test.tinkoff.ru/v2/TinkoffPay/terminals/{terminalKey}/status`
- Боевой: `https://securepay.tinkoff.ru/v2/TinkoffPay/terminals/{terminalKey}/status`

**Обязательный параметр запроса**
- `TerminalKey` — идентификатор терминала

**Обязательные параметры ответа**
- `Success`
- `ErrorCode`
- `Params.Allowed`

**Условная обязательность**
- `Params.Version` — обязательно, если `Allowed = true`

Версии:
- `1.0` — оплата **только с мобильных устройств**
- `2.0` — T-Pay Web

---

## 5. Параметры и ограничения платежей

### 5.1. Валюта

- Поддерживается **только RUB**
- Код валюты: `643`
- При передаче иной валюты используется валюта терминала по умолчанию

---

### 5.2. Тип оплаты

Параметр `PayType`:
- `"O"` — одностадийная оплата
- `"T"` — двухстадийная оплата

---

### 5.3. Язык платёжной формы

Параметр `Language`:
- `ru` — русский (по умолчанию)
- `en` — английский

---

### 5.4. URL-адреса (необязательные)

- `NotificationURL` — приём POST-уведомлений о статусах
- `SuccessURL` — редирект при успешной оплате
- `FailURL` — редирект при неуспешной оплате

Если не переданы — используются настройки терминала.

---

### 5.5. Срок жизни ссылки / QR

Параметр `RedirectDueDate`:
- минимум: **1 минута**
- максимум: **90 дней**
- формат: `YYYY-MM-DDTHH:MM:SS+GMT`

При превышении срока:
- ссылка и QR становятся недействительными;
- платёж невозможен.

---

## 6. Рекуррентные платежи (факт)

Параметры:
- `Recurrent`
- `CustomerKey`

Если:
- `Recurrent = Y`
- разрешена автопривязка карт

→ в нотификации `AUTHORIZED` передаётся:
- `RebillId` (используется в методе `Charge`)

---

## 7. Нотификации и безопасность

- Поддерживаются HTTP(S)-нотификации
- Передаются статусы операций и параметры карт (при разрешённых сценариях)
- Используются настройки терминала, если URL не задан явно

---

## 8. Тестовые карты (факт наличия)

Документация содержит списки:
- тестовых карт для 3DS 2.0
- тестовых карт для 3DS 1.0
- тестовых карт без 3DS

Карты различаются по поведению:
- успешная оплата;
- недостаточно средств;
- отказ эмитента;
- неподдерживаемый 3DS.

---

## 9. Расчёт возмещений

### 9.1. Периодичность

- При наличии РКО Т-Банка — **календарные дни**
- Без РКО — по графику ЦБ РФ
- Реестр считается **за один календарный день**

---

### 9.2. Влияние операций на реестр

| Тип операции | Влияние |
|--------------|--------|
| Debit | Плюс |
| Credit (Refund) | Минус |
| Fee | Минус |
| Chargeback | Минус |
| Chargeback_Reversal | Плюс |
| AUTH_FAIL | В расчёте не участвует (участвует только комиссия) |

---

## 10. Критичные моменты (факт)

- Валюта строго RUB (643)
- Все параметры чувствительны к регистру
- Некоторые параметры обязательны **условно**
- Истёкший `RedirectDueDate` полностью блокирует платёж
- Статус операции определяет участие в реестре и возмещении
- Ошибки эмитента могут возникать после разрешения платёжной системы

---

## 11. Итог

Раздел описывает **строго регламентированный процесс приёма платежей**, где:
- порядок вызова методов обязателен;
- параметры имеют условную обязательность;
- статусы транзакций напрямую влияют на расчёты и выплаты;
- безопасность и поведение зависят от конфигурации терминала.
