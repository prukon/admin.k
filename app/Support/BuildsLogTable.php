<?php

namespace App\Support;

use App\Models\MyLog;
use Yajra\DataTables\Facades\DataTables;

trait BuildsLogTable
{
    /**
     * Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ±Ğ¸Ğ»Ğ´ĞµÑ€ DataTables Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ².
     * @param int|null $type Ğ¢Ğ¸Ğ¿ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¸Ğ»Ğ¸ null Ğ´Ğ»Ñ Ğ²ÑĞµÑ….
     */
    protected function buildLogDataTable(?int $type)
    {
        $partnerId = app('current_partner')->id;

        $logs = MyLog::query()
            ->with(['author', 'user'])
            ->where('partner_id', $partnerId)
            ->when(!is_null($type), fn($q) => $q->where('type', $type))
            ->select('my_logs.*');

        return DataTables::of($logs)
            // ğŸ‘¤ Ğ˜Ğ¼Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ° Ğ²Ğ¼ĞµÑÑ‚Ğ¾ author_id
            ->addColumn('author', function ($log) {
                return $log->author?->full_name ?? 'â€”';
            })
            // ğŸ‘¤ Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
            ->addColumn('user', function ($log) {
                return optional($log->user)->full_name
                    ?? optional($log->user)->name
                    ?? 'â€”';
            })
            // ğŸ· Ğ§ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ğ¹ action
            ->editColumn('action', function ($log) {
                // Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¸Ğ¿Ğ°
                $typeLabels = [

                    11 => 'Ğ˜Ğ·Ğ¼. Ñ†ĞµĞ½ Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ñ… (ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ»ĞµĞ²Ğ°)', //ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ»ĞµĞ²Ğ°
                    12 => 'Ğ˜Ğ½Ğ´. Ğ¸Ğ·Ğ¼. Ñ†ĞµĞ½ (ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ¿Ñ€Ğ°Ğ²Ğ°)', //ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ¿Ñ€Ğ°Ğ²Ğ°
                    13 => 'Ğ˜Ğ·Ğ¼. Ñ†ĞµĞ½ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ  (Ğ¾Ğº)', //ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ¾Ğº"

                    21 => 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ',
                    22 => 'ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑ‡ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑÑ…',
                    23 => 'ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑ‡ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸',
                    24 => 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑÑ…',
                    25 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (Ğ°Ğ´Ğ¼Ğ¸Ğ½)',
                    26 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ',
                    27 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ° (Ğ°Ğ´Ğ¼Ğ¸Ğ½)',
                    28 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ°',
                    29 => 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ°',
                    299 => 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ° (Ğ°Ğ´Ğ¼Ğ¸Ğ½)',

                    210 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾Ğ¿ Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ',
                    211 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°',


                    31 => 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹',
                    32 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹',
                    33 => 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹',

                    40 => 'ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ',

                    50 => 'ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸',



                    500 => 'Ğ”Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€ ÑĞ¾Ğ·Ğ´Ğ°Ğ½',

                    510 => 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ (create)',
                    511 => 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° (ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾)',
                    512 => 'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° (Ğ¾ÑˆĞ¸Ğ±ĞºĞ°)',
                    513 => 'ĞŸĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° (ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾)',
                    514 => 'ĞŸĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° (Ğ¾ÑˆĞ¸Ğ±ĞºĞ°)',
                    519 => 'ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ» Ğ¡ĞœĞ¡',
                    520 => 'Ğ”Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½',



                    60 => 'Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ',

                    70 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº',

                    710 => 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸',
                    720 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸',
                    730 => 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸',

                    80 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°',
                    81 => 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ° ÑÑƒĞ¿ĞµÑ€Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ¼',
                    82 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ° ÑÑƒĞ¿ĞµÑ€Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ¼',
                    83 => 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°',


                    90 => 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ',
                    91 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ',
                    92 => 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ',

                    900 => 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ°',
                    901 => 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ° Ğ² SMS',
                    902 => 'Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ°',




                ];
                return $typeLabels[$log->action] ?? 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ (setting)';
            })
            ->editColumn('created_at', function ($log) {
                return $log->created_at
                    ? $log->created_at->format('d.m.Y / H:i:s')
                    : null;
            })
            ->editColumn('target_type', fn($log) => $log->target_type ?? '-')
            ->editColumn('target_id', fn($log) => $log->target_id ?? '-')
            ->editColumn('target_label', fn($log) => $log->target_label ?? '-')
            ->make(true);
    }
}
